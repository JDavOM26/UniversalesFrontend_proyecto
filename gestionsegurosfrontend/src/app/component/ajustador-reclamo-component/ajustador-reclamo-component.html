<app-navbar-component></app-navbar-component>
<br>
<br>
<br>
<div class="crear-paquetes-contenedor">
  <mat-card>
    <h2>Buscar Pólizas</h2>
    <mat-card-content>
      <div class="filter-container">
        <mat-form-field appearance="fill">
          <mat-label>Seleccionar campo de filtro</mat-label>
          <mat-select [(ngModel)]="filtroSeleccionado">
            <mat-option value="idPoliza">ID Póliza</mat-option>
            <mat-option value="nombreApellido">Nombre completo</mat-option>
            <mat-option value="dpi">DPI</mat-option>
            <mat-option value="nit">NIT</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>Valor de búsqueda</mat-label>
          <input matInput placeholder="Escribe para buscar..." [(ngModel)]="valorBusqueda">
        </mat-form-field>

        <div class="card flex justify-center gap-2">
          <button  class="btn btn-custom" [disabled]="isLoading" (click)="buscarPoliza()">
            Buscar
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
<br>
<br>
<br>
<div class="crear-paquetes-contenedor">
  <div *ngIf="polizas.length === 0 && !isLoading">
    <p>No se encontraron pólizas.</p>
  </div>
  <mat-card class="poliza-card" *ngFor="let poliza of polizas; trackBy: trackById">
    <mat-card-header>
      <mat-card-title>Póliza #{{ poliza.idPoliza }}</mat-card-title>
      <mat-card-subtitle>{{ poliza.nombrePoliza }}</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div class="poliza-details">
        <p><strong>ID Contratante:</strong> {{ poliza.idContratante }}</p>
        <p><strong>Nombre Contratante:</strong> {{ poliza.nombreContratante }}</p>
        <p><strong>Fecha de Inicio:</strong> {{ poliza.fechaCreacion }}</p>
        <p><strong>Fecha de Fin:</strong> {{ poliza.fechaVencimiento }}</p>
        <p><strong>Estado:</strong> {{ poliza.estado }}</p>
        <div *ngIf="poliza.beneficiarios && poliza.beneficiarios.length > 0">
          <h3>Beneficiarios:</h3>
          <ul>
            <li *ngFor="let beneficiario of poliza.beneficiarios">
              {{ beneficiario.primerNombre }} {{ beneficiario.apellidoPrimero }} - {{ beneficiario.parentesco }}
            </li>
          </ul>
        </div>
      </div>
    </mat-card-content>
    <mat-card-actions *ngIf="poliza.estado === 'activa'">
      <button class="btn btn-custom"  (click)="openDialog(poliza)">
        Crear Reclamo
      </button>
    </mat-card-actions>
  </mat-card>
</div>
<br>
<app-progress-spinner-component *ngIf="isLoading"></app-progress-spinner-component>